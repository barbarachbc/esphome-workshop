---
import Footer from '../components/Footer.astro';
import ThemeToggle from '../components/ThemeToggle.astro';
import Lightbox from '../components/Lightbox.astro';
import { siteConfig } from '../config';
import "../styles/global.css";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="My ESPHome Workshop - Personal smart home device tracker" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | My ESPHome Workshop</title>
    
    <!-- Analytics: Umami (only loads if configured) -->
    {siteConfig.analytics.umami.enabled && (
      <script 
        type="text/partytown" 
        src={siteConfig.analytics.umami.url} 
        data-website-id={siteConfig.analytics.umami.websiteId}>
      </script>
    )}
  </head>
  <body>
    <header class="px-8 py-4 shadow-md flex justify-between items-center" style="background: var(--bg-header); color: var(--text-inverse);">
      <h1 class="text-2xl font-semibold m-0" style="color: var(--text-hero);">My ESPHome Workshop</h1>
      <div class="flex gap-4 items-center">
        <ThemeToggle />
        <a href={`https://github.com/${siteConfig.github.repo}`} target="_blank" rel="noopener noreferrer" title="View on GitHub"
           class="text-white no-underline flex items-center gap-1 text-sm transition-opacity hover:opacity-80">
          <svg class="w-5 h-5 fill-current" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          GitHub
        </a>
      </div>
    </header>
    <nav class="px-8 py-3" style="background: var(--bg-nav); border-bottom: 1px solid var(--border-primary);">
      <ul class="list-none flex gap-8 flex-wrap p-0 m-0">
        <li><a href="/" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Home</a></li>
        <li><a href="/devices" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Devices</a></li>
        <li><a href="/components" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Components</a></li>
        <li><a href="/projects" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Projects</a></li>
        <li><a href="/notes" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Notes</a></li>
        <li><a href="/about" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">About</a></li>
        <li><a href="/search" class="no-underline font-medium transition-colors" style="color: var(--text-primary);" onmouseover="this.style.color='var(--accent-blue)';" onmouseout="this.style.color='var(--text-primary)';">Search</a></li>
      </ul>
    </nav>
    <main class="max-w-7xl mx-auto px-8 py-8">
      <slot />
    </main>
    <Footer />
    <Lightbox />
    <script>
      // Add copy buttons to code blocks
      document.addEventListener('DOMContentLoaded', () => {
        const codeBlocks = document.querySelectorAll('pre');
        
        codeBlocks.forEach((pre) => {
          // Create wrapper for relative positioning
          const wrapper = document.createElement('div');
          wrapper.style.position = 'relative';
          pre.parentNode?.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);
          
          // Create copy button
          const button = document.createElement('button');
          button.className = 'copy-code-button';
          button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="10" height="10" rx="1"></rect><path d="M5 1h8a2 2 0 0 1 2 2v8"></path></svg><span>Copy</span>';
          button.setAttribute('aria-label', 'Copy code to clipboard');
          
          button.addEventListener('click', async () => {
            const code = pre.querySelector('code');
            const text = code?.textContent || '';
            
            try {
              await navigator.clipboard.writeText(text);
              
              // Show success feedback
              button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 8 6 11 13 4"></polyline></svg><span>Copied!</span>';
              button.classList.add('copied');
              
              // Reset after 2 seconds
              setTimeout(() => {
                button.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="10" height="10" rx="1"></rect><path d="M5 1h8a2 2 0 0 1 2 2v8"></path></svg><span>Copy</span>';
                button.classList.remove('copied');
              }, 2000);
            } catch (err) {
              console.error('Failed to copy code:', err);
            }
          });
          
          wrapper.appendChild(button);
        });
      });
    </script>
  </body>
</html>
