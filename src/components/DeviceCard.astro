---
interface Props {
  device: {
    slug: string;
    data: {
      title: string;
      description: string;
      category: string;
      manufacturer?: string;
      connectionTypes: string[];
      image?: string;
      status: 'ready' | 'testing' | 'deployed' | 'retired' | 'pending' | 'unsupported' | 'active';
      productionStatus?: 'active' | 'NRND' | 'discontinued' | 'unknown' | 'obsolete';
    };
    displayStatus?: 'ready' | 'testing' | 'deployed' | 'retired' | 'pending' | 'unsupported' | 'active';
  };
}

const { device } = Astro.props;

// Use displayStatus if provided (for computed status), otherwise use data.status
const effectiveStatus = device.displayStatus || device.data.status;

const statusLabels = {
  ready: 'ğŸ“¦ Ready',
  testing: 'ğŸ§ª Testing',
  active: 'ğŸ”§ Active',
  deployed: 'âœ… Deployed',
  retired: 'â¸ï¸ Retired',
  unsupported: 'ğŸš« Unsupported',
  pending: 'ğŸ”¦ Pending',
};

const productionStatusLabels = {
  active: 'âœ… Active',
  NRND: 'âš ï¸ NRND',
  obsolete: 'âŒ Obsolete',
  discontinued: 'âŒ Discontinued',
  unknown: '',
};

// Map connection types to component slugs
const connectionTypeMap: Record<string, string> = {
  'i2c': 'i2c',
  'spi': 'spi',
  'uart': 'uart',
  'gpio': 'gpio',
  'onewire': 'onewire',
  'analog': 'analog',
  'pwm': 'pwm',
  'built-in': 'builtin',
};
---
<div class="block rounded-lg overflow-hidden transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5" style="background: var(--bg-card); border: 1px solid var(--border-card);">
  <a href={`/devices/${device.slug}`} class="no-underline text-inherit">
    <div class="p-6">
      {device.data.image && (
        <img src={device.data.image} alt={device.data.title} class="max-w-24 mb-2 object-cover" />
      )}
      <div class="flex justify-between items-center mb-2">
        <span class="category-badge category-badge-blue">
          {device.data.category}
        </span>
        <span class={`status-badge status-badge-${effectiveStatus}`}>
          {statusLabels[effectiveStatus]}
        </span>
      </div>
      <h3 class="my-2 text-xl" style="color: var(--text-heading);">{device.data.title}</h3>
      <p class="my-3 leading-relaxed" style="color: var(--text-secondary);">{device.data.description}</p>
    </div>
  </a>
  {device.data.connectionTypes.length > 0 && (   
      <div class="flex flex-wrap gap-1.5 px-5 py-3 border-t" style="background: var(--bg-secondary); border-color: var(--border-primary);">
        {device.data.connectionTypes.map(conn => {
          const componentSlug = connectionTypeMap[conn.toLowerCase()];
          return componentSlug ? (
            <a href={`/components/${componentSlug}`} 
               class="connection-badge no-underline transition-all duration-200 hover:-translate-y-0.5" 
               onclick="event.stopPropagation();">
              {conn}
            </a>
          ) : (
            <span class="connection-badge">
              {conn}
            </span>
          )
        })}
      </div>
    )}
</div>
