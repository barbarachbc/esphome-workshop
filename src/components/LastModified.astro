---
interface Props {
  date?: string;
  verified?: string;
  showAge?: boolean;
}

const { date, verified, showAge = false } = Astro.props;

function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
}

function getAgeInDays(dateStr: string): number {
  const date = new Date(dateStr);
  const now = new Date();
  return Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));
}

function getAgeBadge(days: number): string {
  if (days < 30) return 'fresh';
  if (days < 180) return 'recent';
  return 'old';
}

function formatAge(days: number): string {
  if (days < 30) {
    return `${days} day${days === 1 ? '' : 's'} ago`;
  } else if (days < 365) {
    const months = Math.floor(days / 30);
    return `${months} month${months === 1 ? '' : 's'} ago`;
  } else {
    const years = Math.floor(days / 365);
    return `${years} year${years === 1 ? '' : 's'} ago`;
  }
}

const hasDate = date || verified;
const modifiedAge = date ? getAgeInDays(date) : null;
const verifiedAge = verified ? getAgeInDays(verified) : null;

// Determine the overall freshness badge based on the most recent date
let freshnessBadge = '';
if (modifiedAge !== null || verifiedAge !== null) {
  const mostRecentAge = modifiedAge !== null && verifiedAge !== null
    ? Math.min(modifiedAge, verifiedAge)
    : (modifiedAge !== null ? modifiedAge : verifiedAge!);
  freshnessBadge = getAgeBadge(mostRecentAge);
}
---

{hasDate && (
  <div class={`freshness-badge ${
    freshnessBadge === 'fresh' ? 'freshness-badge-fresh' :
    freshnessBadge === 'recent' ? 'freshness-badge-recent' :
    freshnessBadge === 'old' ? 'freshness-badge-old' :
    'freshness-badge-default'
  }`}>
    {date && (
      <div class="flex items-center gap-2 freshness-date-label">
        <span class="text-base">ðŸ“…</span>
        <span class="font-medium freshness-date-value">Last updated:</span>
        <span class="freshness-date-value">{formatDate(date)}</span>
        {showAge && modifiedAge !== null && (
          <span class="italic">({formatAge(modifiedAge)})</span>
        )}
      </div>
    )}
    {verified && (
      <div class="flex items-center gap-2 freshness-date-label">
        <span class="text-base">âœ“</span>
        <span class="font-medium freshness-date-value">Last verified:</span>
        <span class="freshness-date-value">{formatDate(verified)}</span>
        {showAge && verifiedAge !== null && (
          <span class={`italic ${freshnessBadge === 'old' ? 'freshness-age-warning' : ''}`}>({formatAge(verifiedAge)})</span>
        )}
      </div>
    )}
  </div>
)}
