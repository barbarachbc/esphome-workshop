---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const devices = await getCollection('devices');
  return devices.map(device => ({
    params: { slug: device.slug },
    props: { device },
  }));
}

const { device } = Astro.props;
const { Content } = await device.render();
---

<Layout title={`${device.data.title} - Devices`}>
  <article>
    <div class="header">
      <h1>{device.data.title}</h1>
      <div class="meta">
        <span class="badge">{device.data.category}</span>
        {device.data.manufacturer && (
          <span class="manufacturer">{device.data.manufacturer}</span>
        )}
        {device.data.model && (
          <span class="model">Model: {device.data.model}</span>
        )}
      </div>
    </div>

    <div class="description">
      <p><strong>{device.data.description}</strong></p>
    </div>

    {device.data.connectionTypes.length > 0 && (
      <div class="section">
        <h2>Connection Types</h2>
        <div class="connections">
          {device.data.connectionTypes.map(conn => (
            <span class="tag">{conn}</span>
          ))}
        </div>
      </div>
    )}

    <div class="content">
      <Content />
    </div>

    {device.data.purchaseLinks && device.data.purchaseLinks.length > 0 && (
      <div class="section">
        <h2>Where to Buy</h2>
        <ul class="purchase-links">
          {device.data.purchaseLinks.map(link => (
            <li>
              <a href={link.url} target="_blank" rel="noopener noreferrer">
                {link.vendor} →
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}

    <a href="/devices" class="back-link">← Back to all devices</a>
  </article>

  <style>
    article {
      max-width: 800px;
    }

    .header {
      margin-bottom: 2rem;
    }

    .header h1 {
      margin-bottom: 1rem;
    }

    .meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-block;
      background: var(--accent);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .manufacturer, .model {
      color: var(--gray);
      font-size: 0.875rem;
    }

    .description {
      background: var(--light-gray);
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
    }

    .description p {
      margin: 0;
      font-size: 1.125rem;
    }

    .section {
      margin: 2rem 0;
    }

    .connections {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .tag {
      display: inline-block;
      background: var(--light-gray);
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      font-size: 1rem;
      color: var(--text);
      font-weight: 500;
    }

    .content {
      margin: 2rem 0;
    }

    .purchase-links {
      list-style: none;
      padding: 0;
    }

    .purchase-links li {
      margin-bottom: 0.5rem;
    }

    .purchase-links a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    .purchase-links a:hover {
      text-decoration: underline;
    }

    .back-link {
      display: inline-block;
      margin-top: 2rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</Layout>
